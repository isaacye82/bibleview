<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>上海地方教会六十年回顾：人物与历史</title>
    <!-- 引入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入 React 和 ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- 引入 Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- 引入 D3.js 用于绘制知识图谱 -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif; }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        .animate-fadeIn { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* 图谱样式 */
        .node circle { stroke: #fff; stroke-width: 1.5px; cursor: grab; transition: all 0.2s; }
        .node circle:hover { stroke: #3b82f6; stroke-width: 3px; }
        .node text { font-size: 12px; pointer-events: none; text-shadow: 0 1px 0 #fff, 1px 0 0 #fff, 0 -1px 0 #fff, -1px 0 0 #fff; user-select: none; }
        .link { stroke: #94a3b8; stroke-opacity: 0.6; stroke-width: 1.5px; transition: stroke-width 0.2s; }
        .link-label { font-size: 10px; fill: #64748b; pointer-events: none; user-select: none; }
        .graph-container { overflow: hidden; background-color: #f8fafc; cursor: grab; width: 100%; height: 100%; }
        .graph-container:active { cursor: grabbing; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 h-screen flex flex-col overflow-hidden">
    <div id="root" class="h-full flex flex-col"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        // 图标组件
        const IconUser = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>;
        const IconUsers = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>;
        const IconCalendar = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>;
        const IconActivity = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>;
        const IconShare = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>;
        const IconChevronRight = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="9 18 15 12 9 6"/></svg>;
        const IconLink = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>;
        const IconX = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>;
        const IconBookOpen = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>;

        // ----- 数据部分 -----
        const peopleData = {
            zhang_xikang: { name: '张锡康', role: '作者', group: 'core', desc: '本书作者，生化药厂经理。两次入狱。见证了上海教会六十年的变迁。' },
            zhang_guangrong: { name: '张光荣', role: '同工/长老', group: 'elder', desc: '作者父亲，早期同工，负责教会事务接待。' },
            ni_tuosheng: { name: '倪柝声', role: '创始人', group: 'leader', desc: '地方教会发起人。1952年被捕，1972年逝世。' },
            li_changshou: { name: '李常受', role: '同工', group: 'leader', desc: '核心同工，1949年赴台。改革开放后其著作传入大陆引起争议。' },
            li_yuanru: { name: '李渊如', role: '女同工', group: 'elder', desc: '核心女同工，编辑。1956年被捕，狱中去世。' },
            wang_peizhen: { name: '汪佩真', role: '女同工', group: 'elder', desc: '核心女同工。1956年被捕，狱中去世。' },
            yu_chenghua: { name: '俞成华', role: '长老', group: 'elder', desc: '眼科医生，长老。翻译奥秘派书籍。1956年去世。' },
            zhang_yuzhi: { name: '张愚之', role: '长老', group: 'elder', desc: '同工。文革期间因被指控反革命被判死刑。' },
            lan_zhiyi: { name: '蓝志一', role: '同工', group: 'elder', desc: '同工，负责慈幼院。1956年被捕送青海劳改。' },
            tang_shoulin: { name: '唐守临', role: '长老/三自', group: 'tspm', desc: '早期同工。1956年后加入三自，任副主席。晚年对过去有反思。' },
            ren_zhongxiang: { name: '任钟祥', role: '长老/三自', group: 'tspm', desc: '三自积极分子，1958年主导献堂。编写聚会处史料引发争议。' },
            lu_daoxiong: { name: '陆道雄', role: '青年弟兄', group: 'other', desc: '文革受难者，与张愚之同案。' },
            xu_lanying: { name: '徐兰英', role: '姊妹', group: 'other', desc: '改革开放后上海最早恢复的擘饼聚会点（新闸路）在她家。' },
            he_zhaoqing: { name: '贺兆清', role: '弟兄', group: 'other', desc: '张锡康狱中同伴，文革后同工。' },
            shan_yijie: { name: '单亦洁', role: '弟兄', group: 'other', desc: '商人，早期奉献巨资。改革开放后支持恢复聚会。' },
            zhang_pinhui: { name: '张品蕙', role: '倪妻', group: 'family', desc: '倪柝声妻子。文革中受迫害去世。' },
            ni_guizhen: { name: '倪规箴', role: '倪姐', group: 'family', desc: '倪柝声大姐。' },
            chen_kesan: { name: '陈恪三', role: '外地同工', group: 'elder', desc: '福州同工，晚年反对李常受。' },
            huang_deen: { name: '黄得恩', role: '外地同工', group: 'elder', desc: '南昌同工，反对李常受。' },
            jiang_shoudao: { name: '江守道', role: '海外同工', group: 'oversea', desc: '早期同工，后赴美。与唐守临有旧交。' }
        };

        const relationships = [
            { source: 'zhang_xikang', target: 'zhang_guangrong', label: '父子', type: 'family' },
            { source: 'zhang_xikang', target: 'ni_tuosheng', label: '跟随/同工', type: 'work' },
            { source: 'zhang_guangrong', target: 'ni_tuosheng', label: '服事/同工', type: 'work' },
            { source: 'ni_tuosheng', target: 'li_changshou', label: '核心同工', type: 'work' },
            { source: 'ni_tuosheng', target: 'li_yuanru', label: '核心同工', type: 'work' },
            { source: 'ni_tuosheng', target: 'wang_peizhen', label: '核心同工', type: 'work' },
            { source: 'ni_tuosheng', target: 'yu_chenghua', label: '同工', type: 'work' },
            { source: 'ni_tuosheng', target: 'zhang_yuzhi', label: '同工', type: 'work' },
            { source: 'ni_tuosheng', target: 'zhang_pinhui', label: '夫妻', type: 'family' },
            { source: 'ni_tuosheng', target: 'ni_guizhen', label: '姐弟', type: 'family' },
            
            { source: 'tang_shoulin', target: 'ren_zhongxiang', label: '三自同事', type: 'tspm' },
            { source: 'tang_shoulin', target: 'ni_tuosheng', label: '早期同工/后批判', type: 'conflict' },
            { source: 'ren_zhongxiang', target: 'ni_tuosheng', label: '批判/史料定性', type: 'conflict' },
            
            { source: 'zhang_yuzhi', target: 'lu_daoxiong', label: '文革同案', type: 'suffer' },
            { source: 'zhang_xikang', target: 'he_zhaoqing', label: '狱友/同工', type: 'suffer' },
            { source: 'zhang_xikang', target: 'xu_lanying', label: '家庭聚会', type: 'work' },
            { source: 'zhang_xikang', target: 'shan_yijie', label: '好友/同工', type: 'work' },
            { source: 'zhang_xikang', target: 'tang_shoulin', label: '晚年交通', type: 'work' },
            
            { source: 'chen_kesan', target: 'li_changshou', label: '反对', type: 'conflict' },
            { source: 'huang_deen', target: 'li_changshou', label: '反对', type: 'conflict' },
            { source: 'tang_shoulin', target: 'li_changshou', label: '撰文抵制', type: 'conflict' },
            { source: 'jiang_shoudao', target: 'tang_shoulin', label: '旧友', type: 'work' }
        ];

        const groupColors = {
            leader: '#ef4444', 
            core: '#3b82f6',
            elder: '#f59e0b',
            tspm: '#64748b',
            family: '#ec4899',
            oversea: '#8b5cf6',
            other: '#10b981'
        };

        const groupLabels = {
            leader: '核心领袖',
            core: '核心见证人',
            elder: '早期同工/长老',
            tspm: '三自/后期',
            family: '亲属',
            oversea: '海外',
            other: '其他弟兄姊妹'
        };

        // ----- 力导向图组件 -----
        const RelationshipGraph = ({ onSelectPerson }) => {
            const svgRef = useRef(null);
            const [selectedNodeId, setSelectedNodeId] = useState(null);

            useEffect(() => {
                if (!svgRef.current) return;

                const container = d3.select(svgRef.current);
                const width = svgRef.current.clientWidth;
                const height = svgRef.current.clientHeight;

                // 清除容器内的所有内容，重新绘制
                container.selectAll("*").remove();

                const svg = container.append("svg")
                    .attr("width", width)
                    .attr("height", height)
                    .attr("viewBox", [0, 0, width, height]);

                // 准备数据
                const nodes = Object.entries(peopleData).map(([id, data]) => ({ id, ...data }));
                const links = relationships.map(d => ({ ...d }));

                // 箭头标记
                svg.append("defs").selectAll("marker")
                    .data(["end"])
                    .join("marker")
                    .attr("id", d => d)
                    .attr("viewBox", "0 -5 10 10")
                    .attr("refX", 22) // 调整箭头位置
                    .attr("refY", 0)
                    .attr("markerWidth", 6)
                    .attr("markerHeight", 6)
                    .attr("orient", "auto")
                    .append("path")
                    .attr("fill", "#94a3b8")
                    .attr("d", "M0,-5L10,0L0,5");

                const g = svg.append("g");

                // 缩放行为
                const zoom = d3.zoom()
                    .scaleExtent([0.1, 4])
                    .on("zoom", (event) => {
                        g.attr("transform", event.transform);
                    });
                svg.call(zoom);

                // 力模拟
                const simulation = d3.forceSimulation(nodes)
                    .force("link", d3.forceLink(links).id(d => d.id).distance(120))
                    .force("charge", d3.forceManyBody().strength(-400))
                    .force("center", d3.forceCenter(width / 2, height / 2))
                    .force("collide", d3.forceCollide().radius(40));

                // 绘制连线
                const link = g.append("g")
                    .selectAll("g")
                    .data(links)
                    .join("g");

                const linkPath = link.append("path")
                    .attr("class", "link")
                    .attr("marker-end", "url(#end)")
                    .attr("fill", "none");

                // 连线文字背景（使文字更清晰）
                const linkTextBg = link.append("text")
                    .attr("class", "link-label")
                    .attr("dy", -4)
                    .attr("text-anchor", "middle")
                    .style("stroke", "#f8fafc")
                    .style("stroke-width", "3px")
                    .text(d => d.label);

                const linkText = link.append("text")
                    .attr("class", "link-label")
                    .attr("dy", -4)
                    .attr("text-anchor", "middle")
                    .text(d => d.label);

                // 绘制节点
                const node = g.append("g")
                    .selectAll("g")
                    .data(nodes)
                    .join("g")
                    .attr("class", "node")
                    .call(d3.drag()
                        .on("start", dragstarted)
                        .on("drag", dragged)
                        .on("end", dragended));

                // 节点圆形
                const circle = node.append("circle")
                    .attr("r", d => d.group === 'leader' ? 18 : 12)
                    .attr("fill", d => groupColors[d.group])
                    .style("cursor", "pointer")
                    .on("click", (event, d) => {
                        event.stopPropagation();
                        handleNodeClick(d);
                    });

                // 节点文字
                node.append("text")
                    .attr("x", 16)
                    .attr("y", 5)
                    .text(d => d.name)
                    .style("fill", "#334155")
                    .style("font-weight", "500");

                // 模拟更新
                simulation.on("tick", () => {
                    linkPath.attr("d", d => {
                        const dx = d.target.x - d.source.x;
                        const dy = d.target.y - d.source.y;
                        const dr = Math.sqrt(dx * dx + dy * dy);
                        // 稍微弯曲的线，避免重叠
                        return `M${d.source.x},${d.source.y}A${dr},${dr} 0 0,1 ${d.target.x},${d.target.y}`;
                    });

                    // 简单直线计算用于文字位置
                    linkText.attr("x", d => (d.source.x + d.target.x) / 2)
                            .attr("y", d => (d.source.y + d.target.y) / 2);
                    
                    linkTextBg.attr("x", d => (d.source.x + d.target.x) / 2)
                              .attr("y", d => (d.source.y + d.target.y) / 2);

                    node.attr("transform", d => `translate(${d.x},${d.y})`);
                });

                // 拖拽函数
                function dragstarted(event, d) {
                    if (!event.active) simulation.alphaTarget(0.3).restart();
                    d.fx = d.x;
                    d.fy = d.y;
                }

                function dragged(event, d) {
                    d.fx = event.x;
                    d.fy = event.y;
                }

                function dragended(event, d) {
                    if (!event.active) simulation.alphaTarget(0);
                    d.fx = null;
                    d.fy = null;
                }

                // 处理点击
                function handleNodeClick(d) {
                    setSelectedNodeId(d.id);
                    onSelectPerson(d.id);
                    
                    // 高亮效果
                    node.style("opacity", 0.1);
                    link.style("opacity", 0.1);
                    
                    // 找出相关节点和连线
                    const relatedLinks = link.filter(l => l.source.id === d.id || l.target.id === d.id);
                    const relatedNodeIds = new Set();
                    relatedNodeIds.add(d.id);
                    relatedLinks.each(l => {
                        relatedNodeIds.add(l.source.id);
                        relatedNodeIds.add(l.target.id);
                    });

                    // 恢复相关元素透明度
                    node.filter(n => relatedNodeIds.has(n.id)).style("opacity", 1);
                    relatedLinks.style("opacity", 1);
                    relatedLinks.select("path").attr("stroke", "#3b82f6").attr("stroke-width", 2);
                }

                // 点击空白处重置
                svg.on("click", () => {
                    setSelectedNodeId(null);
                    onSelectPerson(null);
                    node.style("opacity", 1);
                    link.style("opacity", 1);
                    link.select("path").attr("stroke", "#94a3b8").attr("stroke-width", 1.5);
                });

                // 处理窗口大小变化
                const handleResize = () => {
                    const newWidth = svgRef.current.clientWidth;
                    const newHeight = svgRef.current.clientHeight;
                    svg.attr("width", newWidth).attr("height", newHeight)
                       .attr("viewBox", [0, 0, newWidth, newHeight]);
                    simulation.force("center", d3.forceCenter(newWidth / 2, newHeight / 2));
                    simulation.alpha(0.3).restart();
                };
                window.addEventListener('resize', handleResize);

                return () => {
                    simulation.stop();
                    window.removeEventListener('resize', handleResize);
                };
            }, []);

            return (
                <div className="flex-1 relative h-full bg-slate-50 flex flex-col">
                    <div className="absolute top-4 left-4 z-10 bg-white/90 p-3 rounded shadow backdrop-blur-sm border border-slate-200 pointer-events-none">
                        <div className="text-xs font-semibold text-slate-500 mb-2">图例</div>
                        <div className="grid grid-cols-2 gap-2 text-xs">
                            {Object.entries(groupLabels).map(([key, label]) => (
                                <div key={key} className="flex items-center">
                                    <div className="w-3 h-3 rounded-full mr-2" style={{backgroundColor: groupColors[key]}}></div>
                                    <span>{label}</span>
                                </div>
                            ))}
                        </div>
                        <div className="mt-3 text-xs text-slate-400 border-t pt-2">
                            * 鼠标滚轮缩放<br/>* 拖拽节点调整位置<br/>* 点击节点查看详情
                        </div>
                    </div>
                    <div ref={svgRef} className="w-full h-full graph-container"></div>
                </div>
            );
        };

        // Timeline 组件
        const TimelineView = ({ onSelectPerson }) => {
            const [activePeriod, setActivePeriod] = useState('pre1949');
            
            const periods = [
                { id: 'pre1949', label: '1949年解放前', title: '早期建立与复兴 (1928-1949)' },
                { id: '50s', label: '50年代', title: '变局与肃反 (1949-1957)' },
                { id: '58to66', label: '58年-文革前', title: '联合礼拜与停滞 (1958-1966)' },
                { id: 'cr', label: '文革期间', title: '动乱与受难 (1966-1976)' },
                { id: 'reform', label: '改革开放', title: '恢复与分歧 (1976-1980s)' },
                { id: 'modern', label: '近现代', title: '回顾与总结 (1990s-)' },
            ];

            const periodDetails = {
                pre1949: {
                    events: [
                        { year: '1928', desc: '倪柝声在上海文德里养病，张光荣一家从杭州迁沪服事，上海教会聚会开始。' },
                        { year: '1934', desc: '第三次得胜聚会；倪柝声结婚引发风波；张锡康得救。' },
                        { year: '1938-42', desc: '倪柝声赴欧访问；回国后讲论“基督的身体”；1942年上海教会风波，倪引退经营生化药厂。' },
                        { year: '1948', desc: '上海教会大复兴。倪柝声恢复职事，“交出来”运动，南阳路145号大会所建成。' },
                        { year: '1949', desc: '李常受受倪柝声嘱托前往台湾；“白衣游行”传福音。' }
                    ],
                    activePeople: ['zhang_xikang', 'zhang_guangrong', 'ni_tuosheng', 'li_changshou', 'li_yuanru', 'wang_peizhen', 'yu_chenghua', 'tang_shoulin']
                },
                '50s': {
                    events: [
                        { year: '1950', desc: '三自爱国运动开始；倪柝声发起签名拥护三自原则但不参加组织。' },
                        { year: '1952', desc: '五反运动，倪柝声在东北被捕；张锡康因生化药厂案第一次被捕。' },
                        { year: '1956', desc: '1月29日大逮捕（肃反），李渊如、汪佩真、张愚之等入狱；定性“倪柝声反革命集团”。' },
                        { year: '1956', desc: '上海教会改组，设立唐守临、任钟祥、刘约翰为长老；加入三自。' },
                        { year: '1957', desc: '全国各地聚会处同工聚会在上海召开，通过《持定所承认的道》。' }
                    ],
                    activePeople: ['ni_tuosheng', 'li_yuanru', 'wang_peizhen', 'zhang_yuzhi', 'lan_zhiyi', 'yu_chenghua', 'tang_shoulin', 'ren_zhongxiang']
                },
                '58to66': {
                    events: [
                        { year: '1958', desc: '大跃进期间，教会献出南阳路145号会所，并入怀恩堂参加“联合礼拜”。' },
                        { year: '1959-66', desc: '因信徒不习惯联合礼拜，争取到在怀恩堂小房间单独擘饼；左弗如起重要作用。' },
                        { year: '1959', desc: '张光荣去世。' }
                    ],
                    activePeople: ['tang_shoulin', 'ren_zhongxiang', 'zhang_xikang']
                },
                cr: {
                    events: [
                        { year: '1966', desc: '文革开始，红卫兵冲击教会，烧毁圣经，信徒受批斗、抄家。' },
                        { year: '1970', desc: '张愚之、陆道雄因被指控反革命而在上海公审后被处决。' },
                        { year: '1972', desc: '倪柝声在安徽白茅岭劳改农场逝世；李渊如、汪佩真在狱中/劳改场去世。' }
                    ],
                    activePeople: ['ni_tuosheng', 'zhang_yuzhi', 'lu_daoxiong', 'zhang_xikang']
                },
                reform: {
                    events: [
                        { year: '1979', desc: '宗教政策落实，三自恢复；张锡康等人在单亦洁、徐兰英家开始恢复家庭擘饼聚会。' },
                        { year: '1980', desc: '国外（李常受著作）书籍经广州传入，引起争议；温州等地教会复兴。' },
                        { year: '1983', desc: '反“呼喊派”运动，张锡康、贺兆清第二次被捕。唐守临、任钟祥出版《坚决抵制...》。' },
                        { year: '1986', desc: '任钟祥为百科全书撰稿引发风波；唐守临退休。' }
                    ],
                    activePeople: ['zhang_xikang', 'he_zhaoqing', 'xu_lanying', 'shan_yijie', 'tang_shoulin', 'ren_zhongxiang']
                },
                modern: {
                    events: [
                        { year: '1990', desc: '张锡康移居美国。' },
                        { year: '1990s', desc: '各房聚会处信徒在不同形式下继续聚会；对历史的反思与争论仍在继续。' }
                    ],
                    activePeople: ['zhang_xikang']
                }
            };

            return (
                <div className="flex flex-col lg:flex-row flex-1 overflow-hidden h-full">
                    {/* 左侧：时期选择 */}
                    <div className="w-full lg:w-64 bg-white border-r border-slate-200 flex flex-col h-full shrink-0">
                        <div className="p-4 bg-slate-100 border-b border-slate-200 font-semibold text-slate-700 flex items-center">
                            <IconCalendar className="w-5 h-5 mr-2" /> 历史时期
                        </div>
                        <div className="overflow-y-auto flex-1">
                            {periods.map((p) => (
                                <button
                                    key={p.id}
                                    onClick={() => activePeriod !== p.id && setActivePeriod(p.id)}
                                    className={`w-full text-left p-4 border-b border-slate-100 transition-colors flex justify-between items-center ${
                                        activePeriod === p.id 
                                            ? 'bg-blue-50 text-blue-800 border-l-4 border-l-blue-600' 
                                            : 'hover:bg-slate-50 text-slate-600'
                                    }`}
                                >
                                    <div>
                                        <div className="font-medium">{p.label}</div>
                                        <div className="text-xs opacity-70 mt-1">{p.title.split('(')[1].replace(')', '')}</div>
                                    </div>
                                    {activePeriod === p.id && <IconChevronRight className="w-4 h-4" />}
                                </button>
                            ))}
                        </div>
                    </div>

                    {/* 中间：事件时间轴 */}
                    <div className="flex-1 p-6 overflow-y-auto bg-slate-50 relative">
                        <div className="max-w-3xl mx-auto">
                            <h2 className="text-2xl font-bold text-slate-800 mb-6 flex items-center sticky top-0 bg-slate-50 py-2 z-20">
                                <IconActivity className="w-6 h-6 mr-2 text-blue-600" />
                                {periods.find(p => p.id === activePeriod)?.title}
                            </h2>

                            <div className="space-y-6 relative before:absolute before:inset-0 before:ml-5 before:-translate-x-px md:before:mx-auto md:before:translate-x-0 before:h-full before:w-0.5 before:bg-gradient-to-b before:from-transparent before:via-slate-300 before:to-transparent">
                                {periodDetails[activePeriod].events.map((event, index) => (
                                    <div key={index} className="relative flex items-center justify-between md:justify-normal md:odd:flex-row-reverse group is-active">
                                        <div className="flex items-center justify-center w-10 h-10 rounded-full border-4 border-white bg-slate-300 group-[.is-active]:bg-blue-500 text-white shadow shrink-0 md:order-1 md:group-odd:-translate-x-1/2 md:group-even:translate-x-1/2 z-10">
                                            <div className="text-xs font-bold">{event.year.slice(-2)}</div>
                                        </div>
                                        <div className="w-[calc(100%-4rem)] md:w-[calc(50%-2.5rem)] bg-white p-4 rounded border border-slate-200 shadow-sm transition-shadow hover:shadow-md">
                                            <div className="flex items-center justify-between space-x-2 mb-1">
                                                <div className="font-bold text-slate-900">{event.year}</div>
                                            </div>
                                            <div className="text-slate-700 leading-relaxed text-sm">
                                                {event.desc}
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                            
                            {/* 当前活跃人物列表 (仅在Timeline View显示作为补充) */}
                            <div className="mt-8 pt-6 border-t border-slate-200">
                                <h3 className="text-lg font-semibold mb-4 text-slate-700">此时期相关人物</h3>
                                <div className="flex flex-wrap gap-2">
                                    {periodDetails[activePeriod].activePeople.map(personId => (
                                        <button
                                            key={personId}
                                            onClick={() => onSelectPerson(personId)}
                                            className="px-3 py-1 bg-white border border-slate-300 rounded-full text-sm hover:bg-blue-50 hover:border-blue-300 transition-colors"
                                        >
                                            {peopleData[personId].name}
                                        </button>
                                    ))}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const MainApp = () => {
            const [view, setView] = useState('graph'); // 默认显示关系图
            const [selectedPersonId, setSelectedPersonId] = useState(null);

            const handleSelectPerson = (id) => {
                setSelectedPersonId(id);
            };

            const personInfo = selectedPersonId ? peopleData[selectedPersonId] : null;

            return (
                <div className="flex flex-col h-screen bg-slate-50 font-sans text-slate-800 overflow-hidden">
                    {/* Header */}
                    <header className="bg-blue-900 text-white p-4 shadow-lg flex justify-between items-center z-30">
                        <div>
                            <h1 className="text-xl font-bold">上海地方教会六十年回顾：人物与历史</h1>
                        </div>
                        <div className="flex space-x-2 bg-blue-800 p-1 rounded-lg">
                            <button
                                onClick={() => setView('timeline')}
                                className={`px-4 py-1.5 rounded text-sm font-medium transition-colors ${view === 'timeline' ? 'bg-white text-blue-900 shadow' : 'text-blue-100 hover:bg-blue-700'}`}
                            >
                                历史时间轴
                            </button>
                            <button
                                onClick={() => setView('graph')}
                                className={`px-4 py-1.5 rounded text-sm font-medium transition-colors ${view === 'graph' ? 'bg-white text-blue-900 shadow' : 'text-blue-100 hover:bg-blue-700'}`}
                            >
                                <IconShare className="w-4 h-4 inline-block mr-1"/>
                                关系图谱
                            </button>
                        </div>
                    </header>

                    <div className="flex flex-1 overflow-hidden relative">
                        {/* Main View Area */}
                        <div className="flex-1 h-full overflow-hidden">
                            {view === 'timeline' ? (
                                <TimelineView onSelectPerson={handleSelectPerson} />
                            ) : (
                                <RelationshipGraph onSelectPerson={handleSelectPerson} />
                            )}
                        </div>

                        {/* Right Sidebar: Details Panel */}
                        <div className={`
                            absolute right-0 top-0 bottom-0 w-80 bg-white border-l border-slate-200 shadow-2xl z-20 
                            transition-transform duration-300 transform 
                            ${selectedPersonId ? 'translate-x-0' : 'translate-x-full'}
                            lg:relative lg:translate-x-0 lg:w-80 lg:block
                        `}>
                            <div className="flex flex-col h-full">
                                <div className="p-4 bg-slate-100 border-b border-slate-200 font-semibold text-slate-700 flex items-center justify-between">
                                    <div className="flex items-center"><IconUser className="w-5 h-5 mr-2" /> 人物详情</div>
                                    <button 
                                        onClick={() => setSelectedPersonId(null)} 
                                        className="text-slate-500 hover:text-slate-800 lg:hidden"
                                    >
                                        <IconX className="w-5 h-5" />
                                    </button>
                                </div>
                                
                                <div className="flex-1 overflow-y-auto p-5">
                                    {personInfo ? (
                                        <div className="animate-fadeIn">
                                            <div className="flex items-center mb-6">
                                                <div 
                                                    className="w-14 h-14 rounded-full flex items-center justify-center text-white text-xl font-bold shadow-md mr-4"
                                                    style={{ backgroundColor: groupColors[personInfo.group] }}
                                                >
                                                    {personInfo.name.charAt(0)}
                                                </div>
                                                <div>
                                                    <h3 className="text-xl font-bold text-slate-800">{personInfo.name}</h3>
                                                    <span className="text-xs font-semibold px-2 py-1 bg-slate-100 text-slate-600 rounded-full border border-slate-200 mt-1 inline-block">
                                                        {personInfo.role}
                                                    </span>
                                                </div>
                                            </div>
                                            
                                            <div className="space-y-6">
                                                <div className="bg-slate-50 p-4 rounded-lg border border-slate-200">
                                                    <h4 className="text-sm font-semibold text-slate-500 mb-2 flex items-center uppercase tracking-wider">
                                                        <IconBookOpen className="w-4 h-4 mr-1" /> 生平简介
                                                    </h4>
                                                    <p className="text-sm text-slate-700 leading-relaxed text-justify">
                                                        {personInfo.desc}
                                                    </p>
                                                </div>

                                                <div>
                                                    <h4 className="text-sm font-semibold text-slate-500 mb-3 flex items-center uppercase tracking-wider">
                                                        <IconActivity className="w-4 h-4 mr-1" /> 主要关系
                                                    </h4>
                                                    <div className="space-y-2">
                                                        {relationships
                                                            .filter(r => r.source === selectedPersonId || r.target === selectedPersonId)
                                                            .map((r, idx) => {
                                                                const isSource = r.source === selectedPersonId;
                                                                const otherId = isSource ? r.target : r.source;
                                                                const otherName = peopleData[otherId].name;
                                                                return (
                                                                    <div 
                                                                        key={idx} 
                                                                        onClick={() => handleSelectPerson(otherId)}
                                                                        className="flex items-center p-2 hover:bg-blue-50 rounded cursor-pointer transition-colors border border-transparent hover:border-blue-100"
                                                                    >
                                                                        <div className={`w-2 h-2 rounded-full mr-3 ${isSource ? 'bg-blue-400' : 'bg-green-400'}`}></div>
                                                                        <div className="flex-1">
                                                                            <div className="text-sm font-medium text-slate-700">
                                                                                {isSource ? `→ ${otherName}` : `← ${otherName}`}
                                                                            </div>
                                                                            <div className="text-xs text-slate-500">{r.label}</div>
                                                                        </div>
                                                                        <IconChevronRight className="w-3 h-3 text-slate-300" />
                                                                    </div>
                                                                );
                                                            })}
                                                        {relationships.filter(r => r.source === selectedPersonId || r.target === selectedPersonId).length === 0 && (
                                                            <div className="text-xs text-slate-400 italic">暂无直接关系记录</div>
                                                        )}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    ) : (
                                        <div className="h-full flex flex-col items-center justify-center text-slate-400 text-center p-4">
                                            <IconUser className="w-12 h-12 mb-3 opacity-20" />
                                            <p className="text-sm">
                                                请在左侧<br/>
                                                {view === 'graph' ? '点击关系图中的节点' : '点击时间轴下方的名字'}<br/>
                                                查看详细信息
                                            </p>
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<MainApp />);
    </script>
</body>
</html>